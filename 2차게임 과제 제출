import 'dart:io';
import 'dart:math';

//ìºë¦­í„° ê¸°ë³¸ í´ë˜ìŠ¤
class Character {
  String name;
  int hp;
  int attack;

  Character(this.name, this.hp, this.attack);

  bool isAlive() => hp > 0;
}

//í”Œë ˆì´ì–´ í´ë˜ìŠ¤
class Player extends Character {
  int level;
  int exp;

  Player(String name)
      : level = 1,
        exp = 0,
        super(name, 100, 15);

  void gainExp(int amount) {
    exp += amount;
    if (exp >= 100) {
      levelUp();
    }
  }

  void levelUp() {
    level++;
    exp = 0;
    hp += 20;
    attack += 5;
    print('\në ˆë²¨ ì—…! í˜„ì¬ ë ˆë²¨: $level');
  }

  // ì§„í–‰ ë°ì´í„° ì €ì¥
  void save() {
    File('player_data.txt').writeAsStringSync('$name,$level,$exp,$hp,$attack');
  }

  // ì €ì¥ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
  static Player? load() {
    try {
      var data = File('player_data.txt').readAsStringSync().split(',');
      return Player(data[0])
        ..level = int.parse(data[1])
        ..exp = int.parse(data[2])
        ..hp = int.parse(data[3])
        ..attack = int.parse(data[4]);
    } catch (e) {
      return null;
    }
  }
}

// ëª¬ìŠ¤í„° í´ë˜ìŠ¤ (ëœë¤ ëŠ¥ë ¥ì¹˜)
class Monster extends Character {
  Monster(String name)
      : super(name, Random().nextInt(30) + 20, Random().nextInt(10) + 5);
}

// ê²Œì„ ì‹¤í–‰ í´ë˜ìŠ¤
class Game {
  Player player;
  Game(this.player);

  void start() {
    print("\n${player.name}ì˜ ëª¨í—˜ì´ ì‹œì‘ë©ë‹ˆë‹¤!");
    while (true) {
      Monster monster = Monster("ëª¬ìŠ¤í„°");
      print("\n${monster.name} ë“±ì¥! (HP: ${monster.hp}, ê³µê²©ë ¥: ${monster.attack})");

      // ì „íˆ¬ ë£¨í”„
      while (player.isAlive() && monster.isAlive()) {
        print("\n[1] ê³µê²©í•˜ê¸°   [2] ë°©ì–´í•˜ê¸°");
        stdout.write("ì„ íƒ: ");
        String? choice = stdin.readLineSync();

        if (choice == '1') {
          // ê³µê²©
          monster.hp -= player.attack;
          print("${player.name}ì˜ ê³µê²©! ëª¬ìŠ¤í„° HP ${monster.hp} ë‚¨ìŒ!");
        } else if (choice == '2') {
          // ë°©ì–´ (ê³µê²© ë¬´íš¨)
          print("${player.name}ì´(ê°€) ë°©ì–´ ìì„¸ë¥¼ ì·¨í–ˆìŠµë‹ˆë‹¤! í”¼í•´ ì—†ìŒ.");
        }

        // ëª¬ìŠ¤í„° ê³µê²©
        if (monster.isAlive()) {
          player.hp -= monster.attack;
          print("ëª¬ìŠ¤í„°ì˜ ë°˜ê²©! ${player.name} HP ${player.hp} ë‚¨ìŒ!");
        }
      }

      // ì „íˆ¬ ì¢…ë£Œ
      if (player.isAlive()) {
        print("\nìŠ¹ë¦¬! ê²½í—˜ì¹˜ +50");
        player.gainExp(50);
        player.save();
      } else {
        print("\nğŸ’€ íŒ¨ë°°... ê²Œì„ ì˜¤ë²„!");
        break;
      }

      // ë‹¤ìŒ ì „íˆ¬ ì—¬ë¶€ í™•ì¸
      stdout.write("\në‹¤ìŒ ëª¬ìŠ¤í„°ì™€ ì‹¸ìš°ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): ");
      String? next = stdin.readLineSync();
      if (next?.toLowerCase() != 'y') break;
    }
  }
}

// ë©”ì¸ ì‹¤í–‰
void main() {
  stdout.write("ìºë¦­í„° ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”: ");
  String? name = stdin.readLineSync();

  // ê¸°ì¡´ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë˜ëŠ” ìƒˆ ìºë¦­í„° ìƒì„±
  Player player = Player.load() ?? Player(name ?? "í”Œë ˆì´ì–´");

  // ê²Œì„ ì‹œì‘
  Game game = Game(player);
  game.start();
}
